# 各ステップでのTips

---

# 背景を理解する

pull_request_template.md でテンプレート化

- 背景(*)
  - この変更が必要な背景を説明してください。
  - SlackやCrashlytics、Zeplinへのリンクなど、発端と経緯が分かるものを含んでください。
  - release note
    - gradleやライブラリなどバージョンを上げるだけであってもリリースノートをちゃんと見る
- 設計方針
  - 変更内容を理解しやすくするための設計方針やクラス図
- 変更内容(*)
  - 主たる変更だけでなく、付随するリファクタリング、フォーマットをかけた、など行った変更をすべて
- スクリーンショット・動画
  - 変更による違いが分かりやすいようなスクリーンショットや動画があれば貼ってください。
- 相談、メモ
  - レビュワー向けのメモや参考にした情報
  - 直接PRへコメントでも可
  - 自信が無い事は先に聞いた方が楽
- 動作確認手順(*)
  - 問題の再現手順
  - 動作確認手順
  - この変更が正しいことを確認するためのすべての手順。CIが通る、UTが通る、でもよい

^ reviewee に descriptionをちゃんと書いてもらいましょう。
説明をちゃんと書く事でrevieweeも考えを整理する事ができます。
また、わかない事はわからないのでどうしたらいいか聞いてもらった方がスムーズなことがあります。
---

# 方針確認編

reviewer はdescriptionをちゃんと読む

- 問題の背景を理解し、実装方針が適切かを考える
- 差分の量
  - 適切な粒度か(family album では最大200行程度)
  - 長すぎる差分だと、手を抜いたり、見落しが発生しがち。なにより、誰もレビューしたがらない。
- テストが適切に書かれているか
  - family albumではE2Eテストは書いていないが、ViewModelやAPIまわりのテストは書いている
  - 境界値が増えたり新規にクラスが増えている場合はテストが必要

---

# 挙動確認

コードを読んでから不具合を発見してしまうよりは、不具合を直してからコードを読む方が手戻りが少ない

- Life cycle
  - ホームボタンからの復帰
  - 画面回転
  - バックグラウンドプロセスキル

- デバッグコードを仕込んで動かす
  - 必要に応じて `delay` を入れてローディングが長くなるようにする
  - エラー処理が適切に行われるか確認

- 開発者向けオプションを活用
  - アクティビティを保持しない
  - アニメーションのスケール変更
  - レイアウト境界の表示

- エミュレータの活用
  - 通信速度の変更
  - 動画の撮影

- デザイン面
  - マテリアルデザインに則っているか(リップル)
  - Themingが適切か

- パフォーマンス
  - Activityの起動やRecyclerViewのスクロールなどスムーズか?

- logcatを見る
  - 新たにWarningなどが増えてないか

- ビルドに関する変更
  - Proguardルールを変えたりライブラリを追加したらProguardビルドをする
  - Debug, Releaseに関わるものはReleseビルドでもチェックする(firebase jsonなど)

---

# コードレビュー編

- コードをローカルに落としてきて、Android Studioで見る
  - コードナビゲーションを利用
  - 気になったら実際にコードを変えてみる
  - コードの削除により、不要になったコードなどはdiffだけでは気付かない

- レイアウトファイルはプレビューを活用して、属性を変えたり要らなさそうな属性を消したときの挙動を確認する

- Githubの機能を活用する
  - ignore whitespaces
  - コードサジェスト機能
  
- コーディングルールを設定で共有する
  - フォーマッタ
  - Lintの設定

- ライブラリの使い方
  - 不自然な記述や気になるところがあれば、他の実現方法が無いか調べる

- リークしていないか
  - Acitivityの強参照など
  - 心配なコードを見つけたらプロファイラを見ながら動かしてみる

- テストが適切に書かれいてるか
  - メソッドの追加
  - 条件文の追加などで、境界値が増えていないか

- 変更していないところも見る
  - 使われなくなったメソッドやフィールドの確認
  - EventBusのように pubsub系に影響がないか
  - minSdkVersionを上げた時などは多くの制御文を消せるかもしれない

- パーミッションの変更
  - Dangerousなものが追加されると自動アップデートが無効になる

- リリース方針の検討
  - あまりに大きな変更であれば、段階リリースを検討

---

# 全体を考えなおす

- 自分のコメントが勘違いだったりしないか考える。こういう事情があってこっちにした、という背景が見えてくることもある。
  - GitHubのコードレビュー機能便利だよ
- 自分がイチから作るとしたらどうするか考える

---

# フィードバックを行う

- 変更が必要であれば具体的な質問と依頼をする
  - コードスニペットを貼る
  - 不具合であれば、発生条件と手順
- 良いと思ったところは素直に褒める
