# 各ステップでのTips

---

# 背景を理解する

pull_request_template.md でテンプレート化

- 背景(*)
  - この変更が必要な背景を説明してください。
  - SlackやCrashlytics、Zeplinへのリンクなど、発端と経緯が分かるものを含んでください。
  - release note
    - gradleやライブラリなどバージョンを上げるだけであってもリリースノートをちゃんと見る
- 設計方針
  - 変更内容を理解しやすくするための設計方針やクラス図
- 変更内容(*)
  - 主たる変更だけでなく、付随するリファクタリング、フォーマットをかけた、など行った変更をすべて
  - descriptionで説明するのが面倒であれば、直接自分でコメントを付けてもよい
- スクリーンショット・動画
  - 変更による違いが分かりやすいようなスクリーンショットや動画があれば貼ってください。
- 相談、メモ
  - レビュワー向けのメモや参考にした情報
  - 直接PRへコメントでも可
  - 自信が無い事は先に聞いた方が楽
- 動作確認手順(*)
  - 問題の再現手順
  - この変更が正しいことを確認するためのすべての手順。CIが通る、UTが通る、でもよい
- 差分の量
  - 適切な粒度か(family album では最大200行程度)
  - 長すぎる差分だと、手を抜いたり、見落しが発生しがち。
  - なにより、誰もレビューしたがらない。
  - フォーマットなどで差分が大きくなる場合は、コミットを分けるなど工夫する

^ reviewee に descriptionをちゃんと書いてもらいましょう。
説明をちゃんと書く事でrevieweeも考えを整理する事ができます。
また、わかない事はわからないのでどうしたらいいか聞いてもらった方がスムーズなことがあります。
気軽にレビューできるPRを作ることが大事です。情報が足りなかったり、わからないPRだと誰もレビューしてくれないまま放置されてしまうかもしれません。
---

# 方針確認編

descriptionを読む

- 問題の背景を理解し、実装方針が適切かを考える

^ わからない、知らない事は調べるか、素直に聞きましょう。伝えるべきことを伝え忘れることもよくあります。

---

# 挙動確認

コードを読んでから不具合を発見してしまうよりは、不具合を直してからコードを読む方が手戻りが少ない
コードをローカルに落としてきて、ビルドする
git worktreeを使うと、自分の作業を邪魔しないので便利

```
git worktree add ~/code-review/branch_name branch_name
android-studio.sh ~/code-review/branch_name
```

^ gradleキャッシュが競合してビルドできない事も起きたりするので、別のディレクトリで確認するのがおすすめです
DataBindin関連の変更などがあるとなおさら危険です。
---

# 見た目

- デザイン面
  - マリアルデザインに則っているか(リップル、アニメーション)
  - styleや色、マージンなど
  - アニメーションのスケール変更(見た目?)
  - レイアウト境界の表示(見た目?)
  - iOS UI

---
# 見た目

- エラー処理
  - エラーをハンドリング適切にしているか
  - データが0件の時でも不自然ではないか
  - デバッグコードを仕込んで動かす
  - 必要に応じて `delay` を入れてローディングが長くなるようにする
  - エミュレータの通信速度の変更, air plane mode
---
# 安定性

- Life cycle
  - ホームボタンからの復帰
  - 画面回転
  - バックグラウンドプロセスキル

- パフォーマンス
  - Activityの起動やRecyclerViewのスクロールなどスムーズか?
  - TTI < 200ms

---
# ビルド

- build, logcatを見る
  - 新たにWarningなどが増えてないか
- ビルドに関する変更
  - Proguardルールを変えたりライブラリを追加したらProguardビルドをする
  - Debug, Releaseに関わるものはReleseビルドでもチェックする(firebase jsonなど)

---

# コードレビュー編

- Android Studioで見る
  - コードナビゲーションを利用
  - 気になったら実際にコードを変えてみる
  - コードの削除により、不要になったコードなどはgithub diffだけでは気付かない
  
---
# 大切にしている視点

大事にしたい事をチームで共有する

- わかりやすい
- 変更が簡単である
- MVVM

^ アーキテクチャーやデザインパターンはあまり詳しくない人でも参考にすると、簡単に機能追加や変更が可能になるように活用されるべき。
---
# layout

- レイアウトファイルはプレビューを活用
- 気になるところは実際に変更を加えてみる
  - 不要そうな属性やネストを消したときの挙動を確認する

---
- Githubの機能を活用する
  - ignore whitespaces
  - コードサジェスト機能
  
---
- コーディングルールを設定で共有する
  - フォーマッタ
  - Lintの設定

---
- ライブラリの使い方
  - 不自然な記述や気になるところがあれば、他の実現方法が無いか調べる
  - 知らないライブラリであれば、実際にソースを読んでみる

^ 別の手段が見つかるかもしれない

---
- リークしていないか
  - Acitivityの強参照など
  - 心配なコードを見つけたらプロファイラを見ながら動かしてみる

^ 画面を進んだり戻ったりしてみて、メモリの使用が増えていたら、リークしているかもしれない
---

- テストが適切に書かれいてるか
  - メソッドの追加
  - 条件文の追加などで、境界値が増えていないか

^ 後からテスト書くのは大変なので、簡単なものだけでも良いので、テストを書けるクラスには書いておいた方が得
---
- 変更していないところも見る
  - 使われなくなったメソッドやフィールドの確認
  - EventBusのように pubsub系に影響がないか
  - minSdkVersionを上げた時などは多くの制御文を消せるかもしれない

---
- アプリの外側への影響
  - パーミッションの変更
    - Dangerousなものが追加されると自動アップデートが無効になる
  - Application クラスをリネーム

---
# 全体を考えなおす

- 自分のコメントが勘違いだったりしないか考える。こういう事情があってこっちにした、という背景が見えてくることもある。
  - single commnetよりはGitHubのコードレビュー機能便利だよ
- 自分がイチから作るとしたらどうするか考える

---
# フィードバックを行う

- 変更が必要であれば具体的な質問と依頼をする
  - コードスニペットを貼る
  - 不具合であれば、発生条件と手順
- 良いと思ったところは素直に褒める

^ 気軽にコメントできる雰囲気を作る方がレビューが楽になる
^ 気軽にPRを出せる and 気軽にレビューできる雰囲気

---

FIN
